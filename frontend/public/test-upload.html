<!DOCTYPE html>
<html>
<head>
    <title>Test Upload Direct</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.0/axios.min.js"></script>
</head>
<body>
    <h1>🧪 Test Upload Direct</h1>
    <p>Connectez-vous d'abord sur l'app, puis revenez ici</p>
    <input type="file" id="fileInput" accept="image/*">
    <button onclick="testUpload()">Test Upload Base64</button>
    <div id="logs" style="background:#f0f0f0; padding:10px; margin:10px 0; font-family:monospace; white-space:pre-wrap;"></div>

    <script>
        function log(message) {
            const logsDiv = document.getElementById('logs');
            logsDiv.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
            console.log(message);
        }

        async function testUpload() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                log('❌ Sélectionnez d\'abord un fichier');
                return;
            }

            log('🎯 === DEBUT TEST UPLOAD ===');
            log('📁 Fichier: ' + file.name + ' (' + file.size + ' bytes, ' + file.type + ')');

            // Vérifier le token
            const token = localStorage.getItem('token');
            if (!token) {
                log('❌ Pas de token - connectez-vous d\'abord sur l\'app');
                return;
            }
            log('🔑 Token présent: ' + token.substring(0, 20) + '...');

            try {
                // Conversion en base64
                log('🔄 Conversion en base64...');
                const base64 = await new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = () => resolve(reader.result);
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });

                log('✅ Base64 généré: ' + base64.substring(0, 50) + '... (' + base64.length + ' chars)');

                const images = [{
                    base64: base64,
                    filename: file.name,
                    type: file.type,
                    size: file.size
                }];

                log('📤 Envoi à l\'API...');
                
                const response = await axios.post('http://localhost:3001/api/profile/photos', 
                    { images },
                    {
                        headers: {
                            'Authorization': 'Bearer ' + token,
                            'Content-Type': 'application/json'
                        }
                    }
                );

                log('✅ Réponse reçue: ' + JSON.stringify(response.data, null, 2));
                log('🎉 === SUCCES ===');

            } catch (error) {
                log('💥 ERREUR: ' + error.message);
                if (error.response) {
                    log('📋 Status: ' + error.response.status);
                    log('📋 Data: ' + JSON.stringify(error.response.data, null, 2));
                }
                log('💥 === ECHEC ===');
            }
        }
    </script>
</body>
</html> 